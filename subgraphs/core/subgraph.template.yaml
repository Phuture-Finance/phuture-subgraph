specVersion: 0.0.3
description: Phuture
repository: https://github.com/Phuturedao/subgraph
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: IndexRegistry
    network: {{network}}
    source:
      abi: IndexRegistry
      address: '{{Registry}}'
      startBlock: {{RegistryBlockNumber}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Asset
      abis:
        - name: IndexRegistry
          file: ../abis/Phuture/IndexRegistry.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
        - name: ChainLink
          file: ../abis/Chainlink/ChainLink.json
        - name: AggregatorInterface
          file: ../abis/Chainlink/AggregatorInterface.json
        - name: UniswapV3PriceOracle
          file: ../abis/Uniswap/UniswapV3PriceOracle.json
        - name: UniswapPathPriceOracle
          file: ../abis/Uniswap/UniswapPathPriceOracle.json
      eventHandlers:
        - event: UpdateAsset(indexed address,uint256)
          handler: handleUpdateAsset
        - event: SetName(address,string)
          handler: handleSetName
        - event: SetSymbol(address,string)
          handler: handleSetSymbol
        - event: RoleGranted(indexed bytes32,indexed address,indexed address)
          handler: handleRoleGranted
        - event: RoleRevoked(indexed bytes32,indexed address,indexed address)
          handler: handleRoleRevoked
      file: ./src/mappings/phuture/indexRegistry.ts

  - kind: ethereum/contract
    name: Index
    network: {{network}}
    source:
      abi: ManagedIndexFactory
      address: '{{ManagedIndexFactory}}'
      startBlock: {{ManagedIndexFactoryBlockNumber}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Index
        - IndexAsset
      abis:
        - name: ManagedIndexFactory
          file: ../abis/Phuture/ManagedIndexFactory.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: ManagedIndexCreated(address,address[],uint8[])
          handler: handleManagedIndexCreated
      file: ./src/mappings/phuture/managedIndexFactory.ts

  - kind: ethereum/contract
    name: ManagedVTokenFactory
    network: {{network}}
    source:
      abi: vTokenFactory
      address: '{{ManagedVTokenFactory}}'
      startBlock: {{ManagedVTokenFactoryBlockNumber}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - vToken
      abis:
        - name: vTokenFactory
          file: ../abis/Phuture/vTokenFactory.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: VTokenCreated(address,address)
          handler: handleStaticVTokenCreated
      file: ./src/mappings/phuture/vTokenFactory.ts

  - kind: ethereum/contract
    name: FeePool
    network: {{network}}
    source:
      abi: FeePool
      address: '{{FeePool}}'
      startBlock: {{FeePoolBlockNumber}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Index
      abis:
        - name: FeePool
          file: ../abis/Phuture/FeePool.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: SetMintingFeeInBP(indexed address,indexed address,uint16)
          handler: handleSetMintingFeeInBP
        - event: SetBurningFeeInBP(indexed address,indexed address,uint16)
          handler: handleSetBurningFeeInBP
        - event: SetAUMScaledPerSecondsRate(indexed address,indexed address,uint256)
          handler: handleSetAUMFeeInBP
      file: ./src/mappings/phuture/feePool.ts

  {{#SVault}}
  - kind: ethereum/contract
    name: SVault
    network: {{network}}
    source:
      abi: Vault
      address: '{{SVault}}'
      startBlock: {{SVaultBlockNumber}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Asset
        - Transfer
      abis:
        - name: Vault
          file: ../abis/SV/Vault.json
        - name: wfCashBase
          file: ../abis/SV/wfCashBase.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
        - name: SVView
          file: ../abis/SV/View.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: FCashMinted(indexed address,uint256,uint256)
          handler: handleFCashMinted
      file: ./src/mappings/sv/vault.ts
  {{/SVault}}

  #-------------------------------------------------------------------------------
  #                               Block Handlers
  #-------------------------------------------------------------------------------

  - kind: ethereum/contract
    name: PhuturePriceOracle
    network: {{network}}
    source:
      abi: PhuturePriceOracle
      address: '{{PhuturePriceOracle}}'
      startBlock: {{PhuturePriceOracleBlockNumber}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Index
        - Asset
      abis:
        - name: PhuturePriceOracle
          file: ../abis/Phuture/PhuturePriceOracle.json
      blockHandlers:
        - handler: handleBlockUpdatePrices
      file: ./src/mappings/blockHandlers.ts

#-------------------------------------------------------------------------------
#                               Template section
#-------------------------------------------------------------------------------
templates:
  - kind: ethereum/contract
    name: Asset
    network: {{network}}
    source:
      abi: Asset
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/phuture/indexRegistry.ts
      entities:
        - Asset
      abis:
        - name: Asset
          file: ../abis/ERC20/ERC20.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer

  - kind: ethereum/contract
    name: ManagedIndex
    network: {{network}}
    source:
      abi: ManagedIndex
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/phuture/managedIndex.ts
      entities:
        - Index
        - Asset
        - DailyIndexStat
      abis:
        - name: IndexRegistry
          file: ../abis/Phuture/IndexRegistry.json
        - name: ManagedIndexFactory
          file: ../abis/Phuture/ManagedIndexFactory.json
        - name: ManagedIndex
          file: ../abis/Phuture/ManagedIndex.json
        - name: ChainLink
          file: ../abis/Chainlink/ChainLink.json
        - name: AggregatorInterface
          file: ../abis/Chainlink/AggregatorInterface.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleManagedIndexTransfer
        - event: UpdateAnatomy(address,uint8)
          handler: handleUpdateAnatomy

  - kind: ethereum/contract
    name: vToken
    network: {{network}}
    source:
      abi: vToken
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - vToken
      abis:
        - name: vToken
          file: ../abis/Phuture/vToken.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
      eventHandlers:
        - event: UpdateDeposit(indexed address,uint256)
          handler: handlerUpdateDeposit
        - event: VTokenTransfer(indexed address,indexed address,uint256)
          handler: handlerVTokenTransfer
        - event: SetVaultController(address)
          handler: handlerSetVaultController
      file: ./src/mappings/phuture/vToken.ts

  - kind: ethereum/contract
    name: erc20
    network: {{network}}
    source:
      abi: ERC20
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - erc20
      abis:
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: vToken
          file: ../abis/Phuture/vToken.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
      file: ./src/mappings/phuture/erc20.ts

  - kind: ethereum/contract
    name: BaseIndex
    network: {{network}}
    source:
      abi: BaseIndex
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      file: ./src/mappings/phuture/baseIndex.ts
      entities:
        - Index
        - Asset
        - DailyIndexStat
      abis:
        - name: BaseIndex
          file: ../abis/Phuture/BaseIndex.json
      eventHandlers:
        - event: AssetRemoved(address)
          handler: handleAssetRemoved
