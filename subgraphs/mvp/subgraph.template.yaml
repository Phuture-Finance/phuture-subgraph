specVersion: 0.0.3
description: Phuture
repository: https://github.com/Phuturedao/subgraph
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: IndexRegistry
    network: {{network}}
    source:
      abi: IndexRegistry
      address: '{{indexRegistryContractAddress}}'
      startBlock: {{indexRegistryStartBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Asset
        - Stat
      abis:
        - name: IndexRegistry
          file: ../abis/Phuture/IndexRegistry.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: UpdateAsset(indexed address,uint256)
          handler: handleUpdateAsset
        - event: SetImageURL(address,string)
          handler: handleSetImageURL
        - event: SetName(address,string)
          handler: handleSetName
        - event: SetSymbol(address,string)
          handler: handleSetSymbol
        - event: RoleGranted(indexed bytes32,indexed address,indexed address)
          handler: handleRoleGranted
        - event: RoleRevoked(indexed bytes32,indexed address,indexed address)
          handler: handleRoleRevoked
      file: ./src/mappings/phuture/indexRegistry.ts

  - kind: ethereum/contract
    name: Index
    network: {{network}}
    source:
      abi: StaticIndexFactory
      address: '{{indexFactoryContractAddress}}'
      startBlock: {{indexFactoryStartBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Index
        - IndexAsset
      abis:
        - name: StaticIndexFactory
          file: ../abis/Phuture/StaticIndexFactory.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: StaticIndexCreated(address,address[],uint8[])
          handler: handleStaticIndexCreated
      file: ./src/mappings/phuture/staticIndexFactory.ts

  - kind: ethereum/contract
    name: Vault
    network: {{network}}
    source:
      abi: Vault
      address: '{{vaultContractAddress}}'
      startBlock: {{vaultStartBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Asset
        - Index
        - IndexAsset
      abis:
        - name: Vault
          file: ../abis/Phuture/Vault.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,indexed address,uint256)
          handler: handleTransfer
      file: ./src/mappings/phuture/vault.ts

  {{#swapFactories}}
  - kind: ethereum/contract
    name: {{{name}}}
    network: {{network}}
    source:
      abi: UniswapFactory
      address: '{{{factoryAddress}}}'
      startBlock: {{{startBlock}}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Pair
        - Asset
      abis:
        - name: UniswapFactory
          file: ../abis/Uniswap/UniswapFactory.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
        - name: ChainLink
          file: ../abis/Chainlink/ChainLink.json
      eventHandlers:
        - event: PairCreated(indexed address,indexed address,address,uint256)
          handler: handleNewPair
      file: ./src/mappings/uniswap/uniswap.ts
  {{/swapFactories}}

  - kind: ethereum/contract
    name: TrackedIndexFactory
    network: {{network}}
    source:
      abi: TrackedIndexFactory
      address: '{{TrackedIndexFactoryAddress}}'
      startBlock: {{TrackedIndexFactoryStartBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Index
        - IndexAsset
      abis:
        - name: TrackedIndexFactory
          file: ../abis/Phuture/TrackedIndexFactory.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: TrackedIndexCreated(address,address[])
          handler: handleTrackedIndexCreated
      file: ./src/mappings/phuture/TrackedIndexFactory.ts

  - kind: ethereum/contract
    name: TopNMarketCapIndexFactory
    network: {{network}}
    source:
      abi: TopNMarketCapIndexFactory
      address: '{{TopNMarketCapIndexFactoryAddress}}'
      startBlock: {{TopNMarketCapIndexFactoryStartBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Index
        - IndexAsset
      abis:
        - name: TopNMarketCapIndexFactory
          file: ../abis/Phuture/TopNMarketCapIndexFactory.json
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
      eventHandlers:
        - event: TopNMarketCapIndexCreated(address,uint256,uint256)
          handler: handleTopNMarketCapIndexCreated
      file: ./src/mappings/phuture/TopNMarketCapIndexCreated.ts

  {{#pairs}}
  - kind: ethereum/contract
    name: {{{name}}}
    network: {{network}}
    source:
      address: '{{{aggregatorAddress}}}'
      abi: AggregatorInterface
      startBlock: {{{block}}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Asset
      file: ./src/mappings/chainlink/aggregators/{{{name}}}.ts
      abis:
        - name: ERC20
          file: ../abis/ERC20/ERC20.json
        - name: ERC20SymbolBytes
          file: ../abis/ERC20/ERC20SymbolBytes.json
        - name: ERC20NameBytes
          file: ../abis/ERC20/ERC20NameBytes.json
        - name: AggregatorInterface
          file: ../abis/Chainlink/AccessControlledOffchainAggregator.json
      eventHandlers:
        - event: AnswerUpdated(indexed int256,indexed uint256,uint256)
          handler: handleAnswerUpdated
  {{/pairs}}

templates:
  - kind: ethereum/contract
    name: Asset
    network: {{network}}
    source:
      abi: Asset
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      file: ./src/mappings/phuture/indexRegistry.ts
      entities:
        - Asset
      abis:
        - name: Asset
          file: ../abis/ERC20/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer

  - kind: ethereum/contract
    name: StaticIndex
    network: {{network}}
    source:
      abi: StaticIndex
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      file: ./src/mappings/phuture/staticIndex.ts
      entities:
        - Index
        - Asset
        - DailyIndexStat
      abis:
        - name: IndexRegistry
          file: ../abis/Phuture/IndexRegistry.json
        - name: StaticIndexFactory
          file: ../abis/Phuture/StaticIndexFactory.json
        - name: StaticIndex
          file: ../abis/Phuture/StaticIndex.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleIndexTransfer

  - kind: ethereum/contract
    name: UniswapPair
    network: {{network}}
    source:
      abi: UniswapPair
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      file: ./src/mappings/uniswap/uniswapPair.ts
      entities:
        - Asset
        - Pair
      abis:
        - name: UniswapPair
          file: ../abis/Uniswap/UniswapPair.json
        - name: UniswapFactory
          file: ../abis/Uniswap/UniswapFactory.json
        - name: ChainLink
          file: ../abis/Chainlink/ChainLink.json
      eventHandlers:
        - event: Sync(uint112,uint112)
          handler: handleSync
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
